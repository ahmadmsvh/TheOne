version: '3.8'

services:
  # Application Services - Development Overrides
  auth-service:
    build:
      context: ./auth-service
      dockerfile: Dockerfile
    volumes:
      - ./auth-service:/app
    command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8001", "--reload"]
    environment:
      - DATABASE_URL=postgresql://postgres:postgres@postgres:5432/theone_db
      - REDIS_URL=redis://redis:6379
      - DEBUG=True
      - ENV=development

  notification-service:
    build:
      context: ./notification-service
      dockerfile: Dockerfile
    volumes:
      - ./notification-service:/app
    environment:
      - RABBITMQ_URL=amqp://admin:admin@rabbitmq:5672/
      - REDIS_URL=redis://redis:6379
      - FLASK_ENV=development
      - FLASK_DEBUG=1
      - DEBUG=True

  product-service:
    build:
      context: ./product-service
      dockerfile: Dockerfile
    volumes:
      - ./product-service:/app
    environment:
      - DATABASE_URL=postgresql://postgres:postgres@postgres:5432/theone_db
      - MONGODB_URL=mongodb://admin:admin@mongodb:27017/theone_db?authSource=admin
      - REDIS_URL=redis://redis:6379
      - FLASK_ENV=development
      - FLASK_DEBUG=1
      - DEBUG=True

  order-service:
    build:
      context: ./order-service
      dockerfile: Dockerfile
    volumes:
      - ./order-service:/app
    command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8002", "--reload"]
    environment:
      - DATABASE_URL=postgresql://postgres:postgres@postgres:5432/theone_db
      - RABBITMQ_URL=amqp://admin:admin@rabbitmq:5672/
      - REDIS_URL=redis://redis:6379
      - DEBUG=True
      - ENV=development

  # Nginx - Development override (optional: reload config on changes)
  nginx:
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/conf.d:/etc/nginx/conf.d:ro

